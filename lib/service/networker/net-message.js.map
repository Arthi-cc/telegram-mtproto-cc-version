{"version":3,"sources":["../../../src/service/networker/net-message.js"],"names":["NetMessage","constructor","uid","dc","seq_no","body","type","acked","container","notContentRelated","createNetworker","longPoll","copyHelper","value","key","msg_id","Object","defineProperty","enumerable","configurable","writable","copyOptions","options","entries","val","size","Uint8Array","byteLength","length","clone","copy","result","NetContainer","inner","innerApi","innerAPI","orig","isAPI","deferred","noShedule","resultType"],"mappings":"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","file":"net-message.js","sourcesContent":["//@flow\n\nimport { generateID } from '../time-manager'\nimport blueDefer, { type Defer } from 'Util/defer'\nimport { type DCNumber } from 'Newtype'\n\ntype BodyBytes = number[] | Uint8Array\n\nexport type NetMessageType =\n  | 'container'\n  | 'api'\n  | 'polling'\n  | 'ack/resend'\n  | 'other'\n\nexport class NetMessage {\n  type: NetMessageType\n  uid: string\n  body: BodyBytes\n  seq_no: number\n  isAPI: boolean\n  innerAPI: ?(string | boolean)[]\n  acked: boolean = false\n  msg_id: string\n  container: boolean = false\n  notContentRelated: boolean = false\n  deferred: Defer\n  requestID: ?string\n  dc: DCNumber\n  noShedule: ?boolean\n  resultType: ?string\n  createNetworker: boolean = false\n  longPoll: boolean = false\n\n  constructor(\n    uid: string,\n    dc: DCNumber,\n    seq_no: number,\n    body: BodyBytes,\n    type: NetMessageType = 'other'\n  ) {\n    this.type = type\n    this.uid = uid\n    this.dc = dc\n    this.msg_id = generateID(uid)\n    this.seq_no = seq_no\n    Object.defineProperty(this, 'body', {\n      enumerable  : false,\n      configurable: true,\n      writable    : true,\n      value       : body\n    })\n    Object.defineProperty(this, 'deferred', {\n      enumerable  : false,\n      configurable: true,\n      writable    : true,\n      value       : blueDefer()\n    })\n    Object.defineProperty(this, 'copyHelper', {\n      enumerable  : false,\n      configurable: true,\n      writable    : true,\n      value       : this.copyHelper\n    })\n  }\n  copyOptions(options: Object) { //TODO remove this\n    for (const [key, val] of Object.entries(options))\n      this.copyHelper(val, key)\n  }\n  copyHelper = (value: any, key: string) => {\n    //$FlowIssue\n    this[key] = value\n  }\n  size() {\n    if (this.body instanceof Uint8Array)\n      return this.body.byteLength\n    else\n      return this.body.length\n  }\n  clone(seq_no: number, dc: DCNumber): NetMessage {\n    const copy = new NetMessage(this.uid, dc, seq_no, this.body, this.type)\n    const result = clone(this, copy)\n    return result\n  }\n}\n\nexport class NetContainer extends NetMessage {\n  inner: string[]\n  type: NetMessageType\n  constructor(\n    uid: string,\n    dc: DCNumber,\n    seq_no: number,\n    body: BodyBytes,\n    inner: string[],\n    innerApi: (string | boolean)[]\n  ) {\n    super(uid, dc, seq_no, body, 'container')\n    this.container = true\n    this.inner = inner\n    this.innerAPI = innerApi\n  }\n  clone(seq_no: number, dc: DCNumber): NetContainer {\n    const copy = new NetContainer(this.uid, dc, seq_no, this.body, this.inner, this.innerAPI /*:: || [] */)\n    const result = clone(this, copy)\n    return result\n  }\n}\n\nfunction clone <+T: NetMessage>(orig: T, copy: T): T {\n  copy.isAPI = orig.isAPI\n  copy.notContentRelated = orig.notContentRelated\n  copy.deferred = orig.deferred\n  copy.acked = orig.acked\n  copy.noShedule = orig.noShedule\n  copy.createNetworker = orig.createNetworker\n  copy.resultType = orig.resultType\n  return copy\n}\n"]}