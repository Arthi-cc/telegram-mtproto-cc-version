{"version":3,"sources":["../../src/tl/reader.js"],"names":["readInt","readLong","readDouble","readString","readBytes","log","ctx","field","result","nextInt","iLow","iHigh","res","buffer","ArrayBuffer","intView","Int32Array","doubleView","Float64Array","bytes","sUTF8","map","getChar","join","s","decodeURIComponent","escape","e","len","nextByte","next","addPadding","String","fromCharCode"],"mappings":";;;;;QAUgBA,O,GAAAA,O;QAMAC,Q,GAAAA,Q;QAQAC,U,GAAAA,U;QAWAC,U,GAAAA,U;QAkBAC,S,GAAAA,S;;AAnDhB;;AACA;;AAEA;;;;;;AACA,IAAMC,MAAM,uBAAO,WAAnB;;AAIO,SAASL,OAAT,CAAiBM,GAAjB,EAAkCC,KAAlC,EAAyD;AAC9D,MAAMC,SAASF,IAAIG,OAAJ,EAAf;AACAJ,MAAI,KAAJ,EAAWE,KAAX,EAAkBC,MAAlB;AACA,SAAOA,MAAP;AACD;;AAEM,SAASP,QAAT,CAAkBK,GAAlB,EAAmCC,KAAnC,EAAmD;AACxD,MAAMG,OAAeV,QAAQM,GAAR,EAAc,GAAGC,KAAO,YAAxB,CAArB;AACA,MAAMI,QAAgBX,QAAQM,GAAR,EAAc,GAAGC,KAAO,aAAxB,CAAtB;;AAEA,MAAMK,MAAM,mBAASD,KAAT,EAAgBD,IAAhB,CAAZ;AACA,SAAOE,GAAP;AACD;;AAEM,SAASV,UAAT,CAAoBI,GAApB,EAAqCC,KAArC,EAAoD;AACzD,MAAMM,SAAS,IAAIC,WAAJ,CAAgB,CAAhB,CAAf;AACA,MAAMC,UAAU,IAAIC,UAAJ,CAAeH,MAAf,CAAhB;AACA,MAAMI,aAAa,IAAIC,YAAJ,CAAiBL,MAAjB,CAAnB;;AAEAE,UAAQ,CAAR,IAAaf,QAAQM,GAAR,EAAc,GAAGC,KAAO,cAAxB,CAAb;AACAQ,UAAQ,CAAR,IAAaf,QAAQM,GAAR,EAAc,GAAGC,KAAO,eAAxB,CAAb;;AAEA,SAAOU,WAAW,CAAX,CAAP;AACD;;AAEM,SAASd,UAAT,CAAoBG,GAApB,EAAqCC,KAArC,EAAoD;AACzD,MAAMY,QAAQf,UAAUE,GAAV,EAAgB,GAAEC,KAAM,SAAxB,CAAd;AACA,MAAMa,QAAQ,CAAC,GAAGD,KAAJ,EACXE,GADW,CACPC,OADO,EAEXC,IAFW,CAEN,EAFM,CAAd;;AAIA,MAAIC,UAAJ;AACA,MAAI;AACFA,QAAIC,mBAAmBC,OAAON,KAAP,CAAnB,CAAJ;AACD,GAFD,CAEE,OAAOO,CAAP,EAAU;AACVH,QAAIJ,KAAJ;AACD;;AAEDf,MAAK,QAAL,EAAcmB,CAAd,EAAkB,GAAEjB,KAAM,SAA1B;;AAEA,SAAOiB,CAAP;AACD;;AAEM,SAASpB,SAAT,CAAmBE,GAAnB,EAAoCC,KAApC,EAAmD;AACxD,MAAIqB,MAAMtB,IAAIuB,QAAJ,EAAV;;AAEA,MAAID,OAAO,GAAX,EAAgB;AACdA,UAAMtB,IAAIuB,QAAJ,KACFvB,IAAIuB,QAAJ,MAAkB,CADhB,GAEFvB,IAAIuB,QAAJ,MAAkB,EAFtB;AAGD;;AAED,MAAMV,QAAQb,IAAIwB,IAAJ,CAASF,GAAT,CAAd;AACAtB,MAAIyB,UAAJ;;AAEA1B,MAAK,OAAL,EAAa,qBAAWc,KAAX,CAAb,EAAiC,GAAGZ,KAAO,QAA3C;;AAEA,SAAOY,KAAP;AACD;;AAGD,IAAMG,UAAWK,CAAD,IAAeK,OAAOC,YAAP,CAAoBN,CAApB,CAA/B","file":"reader.js","sourcesContent":["//@flow\n\nimport { TypeBuffer } from './type-buffer'\nimport { lshift32, bytesToHex } from '../bin'\n\nimport Logger from 'mtproto-logger'\nconst log = Logger`tl:reader`\n\n\n\nexport function readInt(ctx: TypeBuffer, field: string): number {\n  const result = ctx.nextInt()\n  log('int')(field, result)\n  return result\n}\n\nexport function readLong(ctx: TypeBuffer, field: string ) {\n  const iLow: number = readInt(ctx, `${ field }:long[low]`)\n  const iHigh: number = readInt(ctx, `${ field }:long[high]`)\n\n  const res = lshift32(iHigh, iLow)\n  return res\n}\n\nexport function readDouble(ctx: TypeBuffer, field: string) {\n  const buffer = new ArrayBuffer(8)\n  const intView = new Int32Array(buffer)\n  const doubleView = new Float64Array(buffer)\n\n  intView[0] = readInt(ctx, `${ field }:double[low]`)\n  intView[1] = readInt(ctx, `${ field }:double[high]`)\n\n  return doubleView[0]\n}\n\nexport function readString(ctx: TypeBuffer, field: string) {\n  const bytes = readBytes(ctx, `${field}:string`)\n  const sUTF8 = [...bytes]\n    .map(getChar)\n    .join('')\n\n  let s\n  try {\n    s = decodeURIComponent(escape(sUTF8))\n  } catch (e) {\n    s = sUTF8\n  }\n\n  log(`string`)(s, `${field}:string`)\n\n  return s\n}\n\nexport function readBytes(ctx: TypeBuffer, field: string) {\n  let len = ctx.nextByte()\n\n  if (len == 254) {\n    len = ctx.nextByte() |\n        ctx.nextByte() << 8 |\n        ctx.nextByte() << 16\n  }\n\n  const bytes = ctx.next(len)\n  ctx.addPadding()\n\n  log(`bytes`)(bytesToHex(bytes), `${ field }:bytes`)\n\n  return bytes\n}\n\n\nconst getChar = (e: number) => String.fromCharCode(e)"]}