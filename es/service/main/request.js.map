{"version":3,"sources":["../../../src/service/main/request.js"],"names":["Maybe","fromNullable","blueDefer","uuid","ApiRequest","constructor","data","options","uid","dc","requestID","needAuth","allowNoAuth","method","Object","defineProperty","value","enumerable","writable","noAuthMethods","indexOf"],"mappings":";;AAEA;AACA,SAASA,KAAT;AACA,IAAM,EAAEC,YAAF,KAAmBD,KAAzB;;AAEA,OAAOE,SAAP;AACA;AAIA,OAAOC,IAAP;;AAcA,eAAe,MAAMC,UAAN,CAAiB;AAU9BC,cACEC,IADF,EAEEC,OAFF,EAGEC,GAHF,EAIEC,EAJF,EAKE;AAAA,SAZFC,SAYE,GAZeP,MAYf;;AACA,SAAKM,EAAL,GAAUR,aAAaQ,EAAb,CAAV;AACAF,YAAQG,SAAR,GAAoB,KAAKA,SAAzB;AACA,SAAKF,GAAL,GAAWA,GAAX;AACA,SAAKF,IAAL,GAAYA,IAAZ;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKI,QAAL,GAAgB,CAACC,YAAYN,KAAKO,MAAjB,CAAjB;AACAC,WAAOC,cAAP,CAAsB,IAAtB,EAA4B,OAA5B,EAAqC;AACnCC,aAAYd,WADuB;AAEnCe,kBAAY,KAFuB;AAGnCC,gBAAY;AAHuB,KAArC;AAKAJ,WAAOC,cAAP,CAAsB,IAAtB,EAA4B,YAA5B,EAA0C;AACxCC,aAAYd,WAD4B;AAExCe,kBAAY,KAF4B;AAGxCC,gBAAY;AAH4B,KAA1C;AAKD;AA9BD;AAF8B;;AAmChC,IAAMC,gBAAgB,CACpB,eADoB,EAEpB,eAFoB,EAGpB,iBAHoB,EAIpB,aAJoB,EAKpB,aALoB,EAMpB,0BANoB,EAOpB,gBAPoB,EAQpB,mBARoB,CAAtB;;AAWA,IAAMP,cAAeC,MAAD,IAClBM,cAAcC,OAAd,CAAsBP,MAAtB,IAAgC,CAAC,CADnC","file":"request.js","sourcesContent":["//@flow\n\n// import { Maybe, fromNullable } from 'folktale/maybe'\nimport { Maybe } from 'apropos'\nconst { fromNullable } = Maybe\n\nimport blueDefer, { type Defer } from 'Util/defer'\nimport {\n  type DCNumber,\n  type UID,\n} from 'Newtype'\nimport uuid from 'Util/uuid'\n\nexport type ApiMethod = {\n  method: string,\n  params: { [arg: string]: any }\n}\n\nexport type RequestOptions = {\n  dc: DCNumber,\n  requestID: string,\n  resultType: string,\n}\n\n\nexport default class ApiRequest {\n  data: ApiMethod\n  //$off\n  requestID: UID = uuid()\n  uid: UID\n  defer: Defer\n  deferFinal: Defer\n  needAuth: boolean\n  options: RequestOptions\n  dc: Maybe<DCNumber>\n  constructor(\n    data: ApiMethod,\n    options: RequestOptions,\n    uid: UID,\n    dc?: DCNumber\n  ) {\n    this.dc = fromNullable(dc)\n    options.requestID = this.requestID\n    this.uid = uid\n    this.data = data\n    this.options = options\n    this.needAuth = !allowNoAuth(data.method)\n    Object.defineProperty(this, 'defer', {\n      value     : blueDefer(),\n      enumerable: false,\n      writable  : true,\n    })\n    Object.defineProperty(this, 'deferFinal', {\n      value     : blueDefer(),\n      enumerable: false,\n      writable  : true,\n    })\n  }\n}\n\nconst noAuthMethods = [\n  'auth.sendCode',\n  'auth.sendCall',\n  'auth.checkPhone',\n  'auth.signUp',\n  'auth.signIn',\n  'auth.importAuthorization',\n  'help.getConfig',\n  'help.getNearestDc',\n]\n\nconst allowNoAuth = (method: string) =>\n  noAuthMethods.indexOf(method) > -1\n"]}