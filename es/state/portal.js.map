{"version":3,"sources":["../../src/state/portal.js"],"names":["Emitter","fromEvent","Stream","emitter","wildcard","emitState","state","emit","onDispatch","dispatch","on","action","uid","TypeError","rootStream","skipRepeats","multicast","currentState","observe","getState"],"mappings":"AAEA,OAAOA,OAAP;AACA,SAASC,SAAT,EAAoBC,MAApB;;AAEA,OAA2B,WAA3B;;AAEA,OAAO,IAAMC,UAAU,IAAIH,OAAJ,CAAY;AACjCI,YAAU;AADuB,CAAZ,CAAhB;;AAIP,OAAO,SAASC,SAAT,CAAmBC,KAAnB,EAAiC;AACtCH,UAAQI,IAAR,CAAa,OAAb,EAAsBD,KAAtB;AACD;;AAED,OAAO,SAASE,UAAT,CAAoBC,QAApB,EAAmC;AACxCN,UAAQO,EAAR,CAAW,UAAX,EAAuBD,QAAvB;AACD;;AAED,OAAO,SAASA,QAAT,CAAkBE,MAAlB,EAA+BC,GAA/B,EAA4C;AACjD,MAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AAC3B,UAAM,IAAIC,SAAJ,CAAe,2BAA0B,OAAOD,GAAI,IAAGA,GAAI,EAA3D,CAAN;AACD;AACDD,SAAOC,GAAP,GAAaA,GAAb;AACAT,UAAQI,IAAR,CAAa,UAAb,EAAyBI,MAAzB;AACD;;AAED,OAAO,IAAMG,aAA4Bb,UAAU,OAAV,EAAmBE,OAAnB,EACtCY,WADsC,GAEtCC,SAFsC,EAAlC;;AAIP,IAAIC,qBAAJ;;AAEAH,WAAWI,OAAX,CAAmBZ,SAAS;AAC1BW,iBAAeX,KAAf;AACD,CAFD;;AAIA,OAAO,IAAMa,WAAwB,MAAMF,YAApC","file":"portal.js","sourcesContent":["//@flow\n\nimport Emitter from 'eventemitter2'\nimport { fromEvent, Stream } from 'most'\n\nimport { type State } from './index.h'\n\nexport const emitter = new Emitter({\n  wildcard: true\n})\n\nexport function emitState(state: State) {\n  emitter.emit('state', state)\n}\n\nexport function onDispatch(dispatch: any) {\n  emitter.on('dispatch', dispatch)\n}\n\nexport function dispatch(action: any, uid: string) {\n  if (typeof uid !== 'string') {\n    throw new TypeError(`uid must be string, got ${typeof uid} ${uid}`)\n  }\n  action.uid = uid\n  emitter.emit('dispatch', action)\n}\n\nexport const rootStream: Stream<State> = fromEvent('state', emitter)\n  .skipRepeats()\n  .multicast()\n\nlet currentState: State\n\nrootStream.observe(state => {\n  currentState = state\n})\n\nexport const getState: () => State = () => currentState\n"]}