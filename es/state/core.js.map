{"version":3,"sources":["../../src/state/core.js"],"names":["from","createStore","applyMiddleware","compose","createEpicMiddleware","Logger","log","isNode","rootReducer","rootEpic","skipEmptyMiddleware","normalizeActions","tryAddUid","emitState","onDispatch","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","configureStore","initialState","epicMiddleware","enhancers","meta","store","dispatch","rootStream","multicast","observe"],"mappings":"AACA,SAAsBA,IAAtB;AACA,SAASC,WAAT,EAAsBC,eAAtB,EAAuCC,OAAvC;AACA,SAASC,oBAAT;AACA,OAAOC,MAAP;AACA,IAAMC,MAAMD,MAAO,YAAnB;;AAEA,SAASE,MAAT;;AAEA,OAA2B,WAA3B;AACA,OAAOC,WAAP,MAAwB,WAAxB;AACA,OAAOC,QAAP,MAAqB,QAArB;AACA,SAASC,mBAAT,EAA8BC,gBAA9B,EAAgDC,SAAhD,QAAiE,cAAjE;AACA,SAASC,SAAT,EAAoBC,UAApB,QAAsC,UAAtC;;AAEA,IAAIC,mBAAmBZ,OAAvB;;AAGE,IAAII,WAAW,KAAX,IAAoB,OAAOS,MAAP,KAAkB,QAA1C,EACED;AACE;AACAC,OAAOC,oCAAP,IAA+Cd,OAFjD;;;AAoBJ,SAASe,cAAT,CAAwBV,WAAxB,EAAwCW,YAAxC,EAAyD;AACvD,MAAMC,iBAAiBhB,qBAAqBK,QAArB,CAAvB;AACA,MAAMY,YAAYN,iBAChBb,gBACES,iBAAiB,EAAEW,MAAM,EAAR,EAAjB,CADF,EAEEV,SAFF,EAGEF,mBAHF,EAIEU,cAJF,CADgB,CAAlB;;AASA;AACA,MAAMG,QAAQtB,YACZO,WADY,EAEZW,YAFY,EAGZE,SAHY,CAAd;;AAKA,SAAOE,KAAP;AACD;;AAED,IAAMA,QAAQL,eAAeV,WAAf,EAA4B,EAA5B,CAAd;;AAEAM,WAAWS,MAAMC,QAAjB;;AAEA,IAAMC,aAA4BzB,KAAKuB,KAAL,EAAYG,SAAZ,EAAlC;;AAEAD,WAAWE,OAAX,CAAmBd,SAAnB;;AAEA,eAAeU,KAAf","file":"core.js","sourcesContent":["//@flow\nimport { type Stream, from } from 'most'\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport { createEpicMiddleware } from 'redux-most'\nimport Logger from 'mtproto-logger'\nconst log = Logger`redux-core`\n\nimport { isNode } from 'Runtime'\n\nimport { type State } from './index.h'\nimport rootReducer from './reducer'\nimport rootEpic from './epic'\nimport { skipEmptyMiddleware, normalizeActions, tryAddUid } from './middleware'\nimport { emitState, onDispatch } from './portal'\n\nlet composeEnhancers = compose\n\nif (!__DEV__) {\n  if (isNode === false && typeof window === 'object')\n    composeEnhancers =\n      //eslint-disable-next-line\n      window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\n}\n\nif (__DEV__) {\n  // composeEnhancers = require('remote-redux-devtools').composeWithDevTools({\n  //   realtime             : true,\n  //   hostname             : 'localhost',\n  //   port                 : 8000,\n  //   maxAge               : 600,\n  //   suppressConnectErrors: true,\n  // })\n\n  process.on('unhandledRejection', val => {\n    console.log(val)\n    console.trace('on')\n  })\n}\n\nfunction configureStore(rootReducer: *, initialState: *) {\n  const epicMiddleware = createEpicMiddleware(rootEpic)\n  const enhancers = composeEnhancers(\n    applyMiddleware(\n      normalizeActions({ meta: {} }),\n      tryAddUid,\n      skipEmptyMiddleware,\n      epicMiddleware,\n    )\n  )\n\n  //$FlowIssue\n  const store = createStore(\n    rootReducer,\n    initialState,\n    enhancers)\n\n  return store\n}\n\nconst store = configureStore(rootReducer, {})\n\nonDispatch(store.dispatch)\n\nconst rootStream: Stream<State> = from(store).multicast()\n\nrootStream.observe(emitState)\n\nexport default store\n"]}